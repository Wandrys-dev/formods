---
title: "Included Modules"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Included Modules}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

library(formods)
```


# Introduction 

Do you ever make a Shiny app and think: Didn't I just do all this stuff last week? From creating data upload forms to generating a UI for building ggplot figures there are certain components we all use in our apps. The purpose of `formods` is to create customizable Shiny modules to allow many of these components to be created quickly so you can focus on the part of the app that is unique and interesting. 


## Implementation

Each module will have a server function using a short name for the module as a prefix. For example the upload data module would use UD. Each module would then have a series of UI elements that you can place in your UI description. 

* Server
* UI elements
* UI compact 
* YAML configuration

# Avialable modules

```{r, echo = FALSE, eval=TRUE}

curr_mods = FM_fetch_current_mods()
#library(rhandsontable)
#rhandsontable::rhandsontable(curr_mods$df, width=750, rowHeaders = NULL) %>%
#hot_cols(colWidths = c(100, 50, 300, 300)) 


mapping = data.frame(
  col_keys = c("Module", "SN", "htmlOutput", "otherOutput"),
  what     = c("Module", "SN", "htmlOutput", "Other Outputs"),
  stringsAsFactors = FALSE
)

library(flextable)
ft = flextable(curr_mods$df)                       |>
  valign(valign = "top", part = "body")            |>
  set_header_df(mapping = mapping, key="col_keys") |>
  autofit()                                        |>
  theme_vanilla()
ft
```


```
copy.file(system.file(package="formods", "templates", "formods.yaml"), "formods.yaml")
copy.file(system.file(package="formods", "templates", "DW.yaml"),      "DW.yaml")

copy.file(system.file(package="formods", "templates", "DW_module_components.R"),      "DW_module_components.R")
runApp(system.file(package="formods", "templates", "DW_module_components.R"))
```

## Upload Data (UD)

## Data Wrangling (DW)

## Figure Generation (FG)

## App State Management (ASM)

# Module interaction

Say you are using the Upload Data module to feed data into the Data Wrangling module and the user goes back to the upload form and uploads a different data set. This will need to trigger a reset of the Data Wrangling module as well as tell your larger app that something has changed. 

## Module state and reacting to changes

 `react_state[[id_UD]][["DS"]][["checksum"]]`

* `isgood` A boolean variable to indicate the general state of the module. 
* `checksum` A checksum that can be used to detect changes in this module. For
  example in the UD module this will change if the uploaded file or the sheet
  selected from a currently uploaded file changes. 
* `code_previous` Carries over the code from other modules the current one
  depends on. For ecample the DW module would depend on the UD model to load
  the data. So `code_previous` here would contain the code to load the
  dataset.
* `code` Code to repelicate the current state of the module. 

## Configuration file
```{css, echo=FALSE}
.scroll-100 {
  max-height: 100px;
  overflow-y: auto;
  background-color: inherit;
}
```


```{r echo=FALSE, comment='', message=TRUE, eval=TRUE, class.output="scroll-100"}
cat(readLines(file.path(system.file(package="formods"), "templates", "formods.yaml")) , sep="\n")
```
